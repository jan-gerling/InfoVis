<!DOCTYPE html>
<html>
	<head>
		<title>
			Football transfers
		</title>
		<link href="mainpage.css" rel="stylesheet" type="text/css">
		<script type="text/javascript" src="DataModule.js"></script>
		<script type="text/javascript" src="TransferApp.js"></script>
		<link rel=stylesheet href=TransferApp.css>
		<script type="text/javascript" src="d3.min.js" charset="utf-8"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<div class="everything">
			<div class="filler_1"></div>
			<div class="filler_2"></div>
			<div class="filler_3"></div>
			<div class="filler_4"></div>
			<div class="filler_5"></div>

			<p class="cl_n" id="chosen_club">Club:</p>
			<picture class="cl_p">
				<img id="chosen_club_logo" style="height:60px;">
			</picture>
			<p class="le_n" id="league">League:</p>
			<picture class="le_p">
				<img id="chosen_league_logo" style="height:60px;">
			</picture>
			<p class="cl_lt">Clubs:</p>
			<input class="cl_s" type="text" id="clubsearch" onkeyup="club_search()" placeholder="Search for clubs..">
			<ul class="cl_r" id="clubresults">
				<a id="clubres1" onclick=club_choose(1)></a>
				<a id="clubres2" onclick=club_choose(2)></a>
				<a id="clubres3" onclick=club_choose(3)></a>
				<a id="clubres4" onclick=club_choose(4)></a>
				<a id="clubres5" onclick=club_choose(5)></a>
				<a id="clubres6" onclick=club_choose(6)></a>
				<a id="clubres7" onclick=club_choose(7)></a>
			</ul>

			<div class="bargraph" id="main_graph">
				<h2>Club transfers</h2>
				<p><svg width="20" height="20"><circle cx="10" cy="10" r="5" class="in" /></svg> Incoming
				<svg width="20" height="20"><circle cx="10" cy="10" r="5" class="out" /></svg> Outgoing </p>
			</div>
			<div class="bargraph_svg">
				<svg id="main_graph_svg"></svg>
			</div>

			<div class="linegraph" id="secondary_graph">
					<h2>Club transfer income/spending per year</h2>
					<p><svg width="20" height="20"><circle cx="10" cy="10" r="5" class="in" /></svg> Incoming
					<svg width="20" height="20"><circle cx="10" cy="10" r="5" class="out" /></svg> Outgoing </p>
				</div>
			<div class="linegraph_svg">
				<svg id="side_graph_svg"></svg>
			</div>

			<div class="settings">
				<div class="from">
					<b>From year: </b>
					<select id="from_year_list" onchange="update_page()">
						<option>2000</option>
						<option>2001</option>
						<option selected>2002</option>
						<option>2003</option>
						<option>2004</option>
					</select>
				</div>
				<div class="to">
					<b>To year: </b>
					<select id="to_year_list" onchange="update_page()">
						<option>2000</option>
						<option>2001</option>
						<option selected>2002</option>
						<option>2003</option>
						<option>2004</option>
					</select>
				</div>
				<div class="x">
					<b>X view: </b>
					<select id="x_view_list" onchange="update_page()">
						<option value="club" selected>Club</option>
						<option value="league">League</option>
					</select>
				</div>
				<div class="y">
					<b>Y view: </b>
					<select id="y_view_list" onchange="update_page()">
						<option value="value">Value (Â£)</option>
						<option value="amount" selected>Amount of players</option>
					</select>
				</div>
				<div class="sort_by">
						<b>Sort by:</b>
						<select id="sort_by_list" onchange="update_page()">
							<option value="in">Incoming</option>
							<option value="out">Outgoing</option>
							<option value="combined" selected>Combined</option>
						</select>
					</div>
			</div>
		</div>
		<div id='tinyWindow'>
			<div id="tinyImageContainer"><img id="tinyImage" /></div>
			<p>Name: <span id="tinyWindow_name"></span></p>
			<p>Age: <span id="tinyWindow_age"></span></p>
			<p>Transfer value: <span id="tinyWindow_value"></span></p>
			<p>Season: <span id="tinyWindow_season"></span></p>
		</div>
		<script>
			var current_club;
			var all_clubs_list;
			var current_from_year;
			var current_to_year;
			var current_x_view;
			var current_y_view;
			var current_top_ten;
			var current_results = ["arsenal", "barcelona", "paris"];

			function init() {
				all_clubs_list = ["arsenal", "barcelona", "paris", "bayern", "ifk", "/queens-park-rangers/transfers/verein/1039"];
				current_club = "/queens-park-rangers/transfers/verein/1039";
				current_start_year = 2000;
				current_end_year = 2019;
				load_data(2000, 2019, function() {
					console.log("Data ready for chart");
					update_page();
				});
			}

			init();

			function club_search() {
				var input, filter, ul, li, a, i;
				var a = [];
				var b = [];
				input = document.getElementById("clubsearch");
				filter = input.value.toUpperCase();
				a = all_clubs_list;
				for (i = 0; i < all_clubs_list.length; i++) {
					txtValue = all_clubs_list[i];
					if (txtValue.toUpperCase().indexOf(filter) > -1) {
						b.push(txtValue);
					}
				}
				if (b.length > 0) {
					current_results = [];
					for (i = 0; i < 7; i++) {
						resentry = "clubres" +  (i+1);
						document.getElementById(resentry).style.display = "block";
						if (i >= b.length)
							document.getElementById(resentry).innerHTML = "";
						else
							document.getElementById(resentry).innerHTML = b[i];
							current_results[i] = b[i];
					}
					document.getElementById("clubresults").style.display = "block";
				} else {
					document.getElementById("clubresults").style.display = "none";
				}
			}
			function club_choose(n) {
				club = current_results[n-1];
				document.getElementById("clubresults").style.display = "none";
				current_club = club;
				update_page();
			}
			function jump_to_club(num) {
				club = current_top_ten[num-1]
				if (all_clubs_list.includes(club)) {
					document.getElementById("club_list").value = club;
					update_page();
				}
			}
			function club_label_clicked(club) {
				current_club = club;
				update_page();
			}
			function change_current_years(start_year, end_year) {
				if (start_year !== undefined) {
					current_start_year = start_year;
				}
				if (end_year !== undefined) {
					current_end_year = end_year;
				}
				update_page();
			}
			function update_page() {
				console.log("update page");
				document.getElementById("clubsearch").value = "";
				//current_club = document.getElementById("club_list").value;
				current_from_year = document.getElementById("from_year_list").value;
				current_to_year = document.getElementById("to_year_list").value;
				current_x_view = document.getElementById("x_view_list").value;
				current_y_view = document.getElementById("y_view_list").value;
				current_sort_by = document.getElementById("sort_by_list").value;
				document.getElementById("chosen_club").innerHTML = "Club: ".concat(current_club);
				document.getElementById("chosen_club_logo").src = club_to_logo_path(current_club);
				the_league = club_to_league(current_club);
				document.getElementById("league").innerHTML = "League: ".concat(the_league);
				document.getElementById("chosen_league_logo").src = league_to_logo_path(the_league);
				$("#main_graph_svg").empty();
				$("#side_graph_svg").empty();
				main_graph_drawer(current_x_view, current_y_view, current_sort_by, current_club, current_start_year, current_end_year);
			}
			function main_graph_drawer(x, y, sort, club, start_year, end_year) {
				var svg = d3.select("#main_graph_svg");
				var svg_side = d3.select("#side_graph_svg");
				drawClubBarchartClub(svg, window.innerWidth * 0.75, 600, {club, y: y, x: x, sortBy: sort, start_year, end_year});
				drawLineChart(svg_side, window.innerWidth * 0.75, 600, club);
			}
			function club_to_logo_path(club) {
				if (club === "arsenal") {return "test1.png";}
				if (club === "barcelona") {return "test2.png";}
				if (club === "paris") {return "test3.png";}
				if (club === "bayern") {return "https://66.media.tumblr.com/13eb41260c3749687dceb527a0484f45/tumblr_o4ob7gMAsr1qdw1ubo1_75sq.jpg";}
				if (club === "ifk") {return "test2.png";}
				else {return "test3.png";}
			}
			function league_to_logo_path(league) {
				if (league === "some other league") {return "test4.png";}
				if (league === "la liga") {return "test5.png";}
				if (league === "ligoligo") {return "test5.png";}
				if (league === "premier league") {return "https://66.media.tumblr.com/4ac399b75176f80c235067162b7db13b/tumblr_ola8tezLCe1utfwkdo1_500.jpg";}
				if (league === "liga uno") {return "test4.png";}
				else {return "test2.png";}
			}
			function club_to_league(club) {
				if (club === "arsenal") {return "la liga";}
				if (club === "barcelona") {return "premier league";}
				if (club === "paris") {return "some other league";}
				if (club === "bayern") {return "ligoligo";}
				if (club === "ifk") {return "liga uno";}
				else {return "something";}
			}
		</script>
	</body>
</html>
<!--
What should be displayed by default?

Make it the correct years to choose from
Make it the correct clubs to choose between

Make the club_to_league function return true answers
Make the logo functions return true answers

Get the real graphs
Get the real x-axis top ten values

Design the page
Align the ten values with the graph correctly
Show top ten team pictures
 -->
